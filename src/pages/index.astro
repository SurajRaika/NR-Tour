---
import { getCollection } from "astro:content";
import BaseLayout from "@/layouts/BaseLayout.astro";
import TripEntriesOne from "@/components/entries/TripEntriesOne.astro";
import Hero from "@/components/landing/Hero.astro";
import Cta from "@/components/global/Cta.astro";
import Cars from "@/components/global/cars.astro";

const allTrips = await getCollection("trips");
const allPosts = await getCollection("posts"); // Fetch blog posts

const tags = [...new Set(allTrips.map((trip) => trip.data.tags).flat())]; // Tags for trips

// Sort trips by rating in descending order
const sortedTrips = allTrips.sort((a, b) => b.data.rating - a.data.rating);

// Sort posts by publication date in descending order (newest first)
const sortedPosts = allPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<BaseLayout>
  <Hero />
  <section>
    <div class="px-8 md:px-12 mx-auto max-w-7xl py-12 lg:px-32">
      <Cars/>

      <section id="services" class="border-b border-black/20 bg-accent-500">
        <div data-aos="fade-up" class="mx-auto max-w-7xl px-8 py-12 pb-6 gradient-grid">
          <div class="mx-auto text-center">
            <h1 class="text-4xl tracking-tight font-medium font-display text-black md:text-6xl">
              Our Popular Tour Packages
            </h1>
            <p class="max-w-2xl mx-auto px-2 text-lg text-gray-600 font-inter">
              Explore our curated selection of tour packages.
            </p>
          </div>
        </div>
      </section>
      <ul
        class="grid grid-cols-1 mt-12 gap-1 gap-y-24 lg:grid-cols-3 sm:grid-cols-2"
      >
        {
          sortedTrips.map((trip) => (
            <TripEntriesOne
              url={"/trips/" + trip.slug}
              title={trip.data.title}
              description={trip.data.description}
              alt={trip.data.title}
              location={trip.data.location}
              realCost={trip.data.realCost}
              discountedCost={trip.data.discountedCost}
              image={trip.data.image}
              tags={trip.data.tags}
            />
          ))
        }
      </ul>

      {/* New section for Blog Posts */}
      <section id="blog-posts" class="mt-24">
        <div class="mx-auto text-center mb-12">
          <h2 class="text-4xl tracking-tight font-medium font-display text-black md:text-6xl">
            Our Latest Blog Posts
          </h2>
          <p class="max-w-2xl mx-auto px-2 text-lg text-gray-600 font-inter">
            Stay updated with our travel guides and tips.
          </p>
        </div>
        <div class="grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-3">
          {sortedPosts.map((post) => (
            <a href={`/posts/${post.slug}`} class="block p-6 border border-zinc-200 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300">
              <img src={post.data.image.url} alt={post.data.image.alt} class="w-full h-48 object-cover rounded-md mb-4" />
              <h3 class="text-xl font-semibold text-black mb-2">{post.data.title}</h3>
              <p class="text-gray-700 text-sm">{post.data.description}</p>
              <p class="text-xs text-gray-500 mt-2">By {post.data.author} on {post.data.pubDate.toLocaleDateString()}</p>
            </a>
          ))}
        </div>
      </section>

    </div>
  </section>
  <Cta />
</BaseLayout>